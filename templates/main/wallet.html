{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>SOS PAY Wallet</title>
    <!-- FAVICON HEADER -->
    <link rel="icon" type="image/png" href="{% static 'favicon_header/favicon-96x96.png' %}" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="{% static "favicon_header/favicon.svg" %}"/>
    <link rel="shortcut icon" href="{% static "favicon_header/favicon.ico" %}"/>
    <link rel="apple-touch-icon" sizes="180x180" href="{% static "favicon_header/apple-touch-icon.png" %}" />
    <link rel="manifest" href="{% static "favicon_header/site.webmanifest" %}" />

    <!-- ==== STYLE.CSS ==== -->
    <link rel="stylesheet" href="{% static 'style2.css' %}" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

    <!-- ====  REMIXICON CDN ==== -->
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css"
      rel="stylesheet"
    />

    <!-- ==== ANIMATE ON SCROLL CSS CDN  ==== -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
  </head>
  <body>
    <!-- ==== HEADER ==== -->
    <header class="container header">
      <!-- ==== NAVBAR ==== -->
      <nav class="nav">
        <div class="logo">
          <a href="/"><img id="logo" src="{% static 'sos-pay-high-resolution-logo-transparent.png'%}" alt="logo"></a>
        </div>

        <div class="nav_menu" id="nav_menu">
          <button class="close_btn" id="close_btn">
            <i class="ri-close-fill"></i>
          </button>

          <ul class="nav_menu_list">
            <li class="nav_menu_item">
              <a href="/" class="nav_menu_link">Home</a>
            </li>
            <li class="nav_menu_item">
              <a href="/account" class="nav_menu_link">Account</a>
            </li>
            <li class="nav_menu_item">
              <a href="/wallet" class="nav_menu_link">Wallet</a>
            </li>
            <li class="nav_menu_item">
              <a href="/wallet#transactions" class="nav_menu_link">Transactions</a>
            </li>
            {% if user.is_authenticated %}
                <li class="nav_menu_item">
                    <a href="/login/signout" class="nav_menu_link">Signout</a>
                </li>
            {% else %}
                <li class="nav_menu_item">
                    <a href="#" class="nav_menu_link">Login</a>
                </li>
            {% endif %}
            
            
          </ul>
        </div>

        <button class="toggle_btn" id="toggle_btn">
          <i class="ri-menu-line"></i>
        </button>
      </nav>
    </header>

    <section class="wrapper">
      <div class="container">
        <div class="grid-cols-2">
          <div class="grid-item-1">
            <h1 class="main-heading">
                {% if user.is_authenticated %}
                    Hello <span>{{ fname }}</span>
                    <br>
                    <br>
                    Balance: GHC <div id="balance"> 
                      <span id="balanceValue">•••••</span>
                      <i id="toggleIcon" class="fas fa-eye"></i>
                {% else %}
                    Hello <span> User</span>
                    <br>
                    <br> 
                {% endif %}
            </h1>
            <h1 class="sub-heading">
              {% if user.is_authenticated %}
              <br>
              <br>
              <div id="wallet_code" class="wallet_code">
                    Wallet code: 
                      <span id="WalletValue">•••••</span>
                      <i id="toggleIcon2" class="fas fa-eye"></i>

              {% endif %}
              </h1>

            <div class="btn_wrapper">
              <a href="/pay"><button class="btn view_more_btn">
                Add funds <i class="ri-arrow-right-line"></i>
              </button></a>
              <form method="POST" action="/wallet/request">
                {% csrf_token %}
                <button type="submit" class="btn view_more_btn" onclick="this.disabled=true; this.form.submit();">Request Funds <i class="ri-arrow-right-line"></i></button>
              </form>
              
            <br>
            <br> 
          </div>
          <div>
            <br>
            <br>
            
          </div>
        </div>
      </div>
    </section>

    <section class="wrapper">
      <div class="container" data-aos="fade-up" data-aos-duration="1000">
        <h2 class="transaction-header" id="transactions">Recent Transactions</h2>
        <table class="transactions-table">
          <thead>
            <tr>
              <th>Description</th>
              <th>Value</th>
              <th>Running Balance</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody>
            {% for transaction in page_obj %}
              <tr>
                <td>{{ transaction.transaction_from }}</td>
                <td data-label="Value">{{ transaction.value }}</td>
                <td data-label="Running Balance">{{ transaction.running_balance }}</td>
                <td data-label="Date">{{ transaction.created_at|date:"Y-m-d H:i" }}</td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="4" style="text-align: center; color: var(--text-content);">
                  No transactions found.
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>

        <div style="margin-top: 1.5rem;">
          <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
          {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}" class="btn view_more_btn">Previous</a>
          {% endif %}
          {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}" class="btn view_more_btn">Next</a>
          {% endif %}
        </div>

        
        
      </div>
    </section>
    
    

    <!-- ==== ANIMATE ON SCROLL JS CDN -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <!-- ==== GSAP CDN ==== -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.8.0/gsap.min.js"></script>
    <!-- ==== SCRIPT.JS ==== -->
    <script src="./script.js" defer></script>
    <script>
        const navId = document.getElementById("nav_menu"),
        ToggleBtnId = document.getElementById("toggle_btn"),
        CloseBtnId = document.getElementById("close_btn");

        document.addEventListener("DOMContentLoaded", () => {
          const balanceValue = document.getElementById("balanceValue");
          const toggleIcon = document.getElementById("toggleIcon");

          let isVisible = false;

          toggleIcon.addEventListener("click", () => {
              if (isVisible) {
                  balanceValue.textContent = "•••••";
                  toggleIcon.classList.remove("fa-eye");
                  toggleIcon.classList.add("fa-eye-slash");
              } else {
                  balanceValue.textContent = "{{ balance }}"; // Replace with actual balance dynamically
                  toggleIcon.classList.remove("fa-eye-slash");
                  toggleIcon.classList.add("fa-eye");
              }
              isVisible = !isVisible;
          
          });
        });
        document.addEventListener("DOMContentLoaded", () => {
          const WalletValue = document.getElementById("WalletValue");
          const toggleIcon2 = document.getElementById("toggleIcon2");

          let isVisible2 = false;

          toggleIcon2.addEventListener("click", () => {
              if (isVisible2) {
                  WalletValue.textContent = "•••••";
                  toggleIcon2.classList.remove("fa-eye");
                  toggleIcon2.classList.add("fa-eye-slash");
              } else {
                  WalletValue.textContent = "{{ private_code }}"; // Replace with actual balance dynamically
                  toggleIcon2.classList.remove("fa-eye-slash");
                  toggleIcon2.classList.add("fa-eye");
              }
              isVisible2 = !isVisible2;
          
          });
        });


        // ==== SHOW MENU ==== //
        ToggleBtnId.addEventListener("click", () => {
        navId.classList.add("show");
        });

        // ==== HIDE MENU ==== //
        CloseBtnId.addEventListener("click", () => {
        navId.classList.remove("show");
        });

        
        // ==== Animate on Scroll Initialize  ==== //
        AOS.init();

        // ==== GSAP Animations ==== //
        // ==== LOGO  ==== //
        gsap.from(".logo", {
        opacity: 0,
        y: -10,
        delay: 1,
        duration: 0.5,
        });
        // ==== NAV-MENU ==== //
        gsap.from(".nav_menu_list .nav_menu_item", {
        opacity: 0,
        y: -10,
        delay: 1.4,
        duration: 0.5,
        stagger: 0.3,
        });
        // ==== TOGGLE BTN ==== //
        gsap.from(".toggle_btn", {
        opacity: 0,
        y: -10,
        delay: 1.4,
        duration: 0.5,
        });
        // ==== MAIN HEADING  ==== //
        gsap.from(".main-heading", {
        opacity: 0,
        y: 20,
        delay: 2.4,
        duration: 1,
        });
        // ==== INFO TEXT ==== //
        gsap.from(".info-text", {
        opacity: 0,
        y: 20,
        delay: 2.8,
        duration: 1,
        });
        // ==== CTA BUTTONS ==== //
        gsap.from(".btn_wrapper", {
        opacity: 0,
        y: 20,
        delay: 2.8,
        duration: 1,
        });
        // ==== TEAM IMAGE ==== //
        gsap.from(".team_img_wrapper img", {
        opacity: 0,
        y: 20,
        delay: 3,
        duration: 1,
        });
        // ==== TEAM IMAGE ==== //
        gsap.from(".wallet_code", {
        opacity: 0,
        y: 20,
        delay: 3,
        duration: 1,
        });
    </script>
  </body>
</html>